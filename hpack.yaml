name:                unicode-transforms
version:             0.1.0.0
synopsis:            Unicode normalization
description:
  Fast Unicode normalization in Haskell (NFC/NFD/NFKC/NFKD).

homepage:            http://github.com/harendra-kumar/unicode-transforms
license:             BSD3
license-file:        LICENSE
author:              Harendra Kumar
maintainer:          harendra.kumar@gmail.com
copyright:
  - 2016 Harendra Kumar
  - 2014â€“2015 Antonio Nikishaev
category:            Data,Text,Unicode
stability:           Experimental
github:              harendra-kumar/unicode-transforms

tested-with: GHC==7.8.4, GHC==7.10.3, GHC==8.0.1

extra-source-files:
  - Changelog.md
  - NOTES.md
  - README.md
  - benchmark/data/*.txt
  - utf8proc/cbits/*.h
  - utf8proc/cbits/XQillaExport.hpp
  - stack.yaml
  - stack-7.8.yaml
  - stack-7.10.yaml
  - stack-8.0.yaml
  - unicode-data/README.md
  - unicode-data/ucd/NormalizationTest.txt
  - unicode-data/extra/NormalizationTest.txt

flags:
  has-llvm:
    description: Use llvm backend for compilation
    default: False
    manual: True
  has-icu:
    description: Use text-icu for benchmark and test comparisons
    default: False
    manual: True
  no-opt:
    description: Disable optimization to compile with lower memory (for CI)
    default: False
    manual: True

ghc-options:
  - -Wall
  - -fwarn-identities
  - -fwarn-incomplete-record-updates
  - -fwarn-incomplete-uni-patterns
  - -fwarn-tabs

dependencies: base >= 4.7 && < 5

library:
  when:
    - condition: flag(no-opt)
      then:
        ghc-options: -O0
      else:
        ghc-options: -O2 -funbox-strict-fields
  when:
    - condition: flag(has-llvm)
      ghc-options: -fllvm

  source-dirs: .
  exposed-modules:
    - Data.ByteString.UTF8.Normalize
    - Data.String.Normalize
    - Data.Text.Normalize
    - Data.Unicode.Types
    - Data.Unicode.Internal.NormalizeStream
    - Data.Unicode.Properties.CombiningClass
  other-modules:
    - Data.Unicode.Properties.Compositions
    - Data.Unicode.Properties.Decomposable
    - Data.Unicode.Properties.DecomposableK
    - Data.Unicode.Properties.Decompose
    - Data.Unicode.Properties.DecomposeHangul
    - Data.Unicode.Properties.Decompositions
    - Data.Unicode.Properties.DecompositionsK
  dependencies:
    - bitarray
    - bytestring
    - text

# developer mode only
executables:
  normalizefile:
    ghc-options: -O2 -funbox-strict-fields
    source-dirs: benchmark
    main:        NormalizeFile.hs
    other-modules: []
    dependencies:
      - deepseq >= 1.1.0.0
      - filepath
      - path
      - path-io
      - text
      - unicode-transforms

tests:
  ucd:
    ghc-options: -O0
    source-dirs: test
    main:        NormalizationTest.hs
    other-modules: []
    dependencies:
      - getopt-generics
      - split
      - text
      - unicode-transforms
  quickcheck:
    ghc-options: -O0
    source-dirs: test
    main:        Properties.hs
    other-modules: QuickCheckUtils
    dependencies:
      - deepseq >= 1.1.0.0
      - QuickCheck
      - text
      - unicode-transforms
    when:
      - condition: flag(has-icu)
        cpp-options: -DHAS_ICU
        dependencies:
          - text-icu >= 0.6.2.1
  extras:
    ghc-options: -O0
    source-dirs: test
    main:        Extra.hs
    other-modules: QuickCheckUtils
    dependencies:
      - deepseq >= 1.1.0.0
      - QuickCheck
      - text
      - unicode-transforms

benchmarks:
  bench:
    ghc-options: -O2 -funbox-strict-fields
    when:
      - condition: flag(has-icu)
        cpp-options: -DBENCH_ICU
        dependencies:
          - text-icu >= 0.6.2.1

    source-dirs: 
      - benchmark
      - utf8proc
    main:        Benchmark.hs

    # utf8proc implementation for comparisons only
    cc-options: -Wall
    include-dirs: utf8proc/cbits
    c-sources:    utf8proc/cbits/utf8proc.c
    exposed-modules:
      - Data.Text.NormalizeUTF8Proc
    other-modules:
      - Data.Unicode.UTF8Proc

    dependencies:
      - bitarray
      - criterion >= 0.4.0
      - deepseq >= 1.1.0.0
      - filepath
      - optparse-applicative
      - path
      - path-io
      - text
      - unicode-transforms
